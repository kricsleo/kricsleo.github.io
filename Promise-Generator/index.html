<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <meta name="description" content="It&#39;s my personal blog.">
  <meta name="keywords" content="blog,kricsleo,IT,Web Front End">
  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>Promise-Generator | kricsleo</title>
  <link rel="shortcut icon" href="/images/favicon.ico">
  <link rel="alternate" href="/atom.xml" title="kricsleo">
  <style>
    @font-face {
      font-family: "RobotoMono-Iconfont";
      font-style: normal;
      font-display: swap;
      src: url("/fonts/RobotoMono-Iconfont.woff") format("woff");
    }
    .loader {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0px;
      left: 0px;
      background-color: rgba(255, 255, 255, .7);
      z-index: 999;
      transition: all .4s;
    }
    .loader:before {
      content: '';
      display: block;
      position: absolute;
      left: 50%;
      top: 50%;
      width: 50px;
      height: 50px;
      margin-top: -25px;
      margin-left: -25px;
      background-color: #0097e4;
      -webkit-animation: rotateplane 1.2s infinite ease-in-out;
      animation: rotateplane 1.2s infinite ease-in-out;
    }
    .loader:after {
      content: 'loading';
      font-family: 'RobotoMono-Iconfont';
      visibility: hidden;
    }
    @-webkit-keyframes rotateplane {
        0% {
            -webkit-transform: perspective(120px)
        }

        50% {
            -webkit-transform: perspective(120px) rotateY(180deg)
        }

        100% {
            -webkit-transform: perspective(120px) rotateY(180deg) rotateX(180deg)
        }
    }
    @keyframes rotateplane {
        0% {
            transform: perspective(120px) rotateX(0deg) rotateY(0deg);
            -webkit-transform: perspective(120px) rotateX(0deg) rotateY(0deg)
        }

        50% {
            transform: perspective(120px) rotateX(-180.1deg) rotateY(0deg);
            -webkit-transform: perspective(120px) rotateX(-180.1deg) rotateY(0deg)
        }

        100% {
            transform: perspective(120px) rotateX(-180deg) rotateY(-179.9deg);
            -webkit-transform: perspective(120px) rotateX(-180deg) rotateY(-179.9deg)
        }
    }
  </style>
</head>
</html>
<body>
  <div class="loader"></div>

  <header class="l_header" style="display: none;">
	<div class="wrapper">
		<div class="nav-main container container--flex">
			<a class="logo flat-box" href="/">
				kricsleo
			</a>
			<div class="menu">
				<ul class="h-list">
					
						<li>
							<a class="flat-box nav-home" href="/">
								Home
							</a>
						</li>
					
						<li>
							<a class="flat-box nav-categories" href="/categories">
								Categories
							</a>
						</li>
					
						<li>
							<a class="flat-box nav-archives" href="/archives">
								Archives
							</a>
						</li>
					
						<li>
							<a class="flat-box nav-about" href="https://github.com/kricsleo">
								About
							</a>
						</li>
					
				</ul>
				<div class="underline"></div>
			</div>
			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="Search">
						<span class="iconfont icon-search"></span>
					</form>
				</div>
			
			<ul class="switcher h-list">
				
					<li class="s-search"><a href="javascript:void(0)"><span class="iconfont icon-search flat-box"></span></a></li>
				
				<li class="s-menu"><a href="javascript:void(0)"><span class="iconfont icon-menu flat-box"></span></a></li>
			</ul>
		</div>
		
		<div class="nav-sub container container--flex">
			<a class="logo" href="javascript:void(0)">
				Word of Forks
			</a>

			<ul class="switcher h-list">
				<li class="s-comment"><a href="javascript:void(0)"><span class="iconfont icon-chat_bubble_outline flat-box"></span></a></li>
				<li class="s-top"><a href="javascript:void(0)"><span class="iconfont icon-arrow_upward flat-box"></span></a></li>
				<li class="s-toc"><a href="javascript:void(0)"><span class="iconfont icon-format_list_numbered flat-box"></span></a></li>
			</ul>
		</div>
	</div>
</header>

  <div class="l_body" style="display: none;">
    <div class='container clearfix'>
      <div class='l_main'>
        <article id="post-Promise-Generator" class="post white-box article-type-post" itemscope="" itemprop="blogPost">
	
		<section class="toc-wrapper active"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#异步解决方案"><span class="toc-number">1.</span> <span class="toc-text">异步解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#回调地狱"><span class="toc-number">1.1.</span> <span class="toc-text">回调地狱</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Promise"><span class="toc-number">1.2.</span> <span class="toc-text">Promise</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Generator"><span class="toc-number">1.3.</span> <span class="toc-text">Generator</span></a></li></ol></li></ol></section>
	
	<section class="article typo">
  	<div class="article-entry" itemprop="articleBody">
    	<h1 id="异步解决方案"><a href="#异步解决方案" class="headerlink" title="异步解决方案"></a>异步解决方案</h1><p>本文是为了解js的异步操作解决方案发展过程. 从原始的回调地狱到ES6的<code>Promise</code>和<code>Generator</code>再到ES7提案阶段的<code>async</code>.</p>
<a id="more"></a>
<h2 id="回调地狱"><a href="#回调地狱" class="headerlink" title="回调地狱"></a>回调地狱</h2><p>我们之前会把异步的事件写在回调函数里面, 如果有一系列的异步事件, 并且这些事件是按照顺序触发的, 那么我们的代码最后的结构很可能就是回调里面放回调再放回调, 一层层往里面嵌套, 堪称’地狱’.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">fs.readFile(<span class="string">'/etc/passwd'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a><code>Promise</code></h2><p>为了避免回调地狱的代码横向发展, 在 ES6 里面引入了 <code>Promise</code> 这种新的写法, 使得代码从横向发展变成了链式的纵向发展. 通过<code>then()</code>来执行回调, 使得代码的逻辑变得清晰, 写法也更简洁. 关键点有三个, <code>resolve</code>, <code>reject</code>和<code>then</code>.</p>
<p>常见的写法如下:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建一个 Promise 对象</span></span><br><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span>(<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ... some code</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="comment">/* 异步操作成功 */</span>)&#123;</span><br><span class="line">    resolve(value);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对这个 Promise 对象进行链式操作</span></span><br><span class="line">promise.then(<span class="function"><span class="keyword">function</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// success</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// failure</span></span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// js error</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a><code>Generator</code></h2><p><code>Generator</code>函数有一个语法糖, 叫做<code>async</code>函数, 两者的写法类似, 只是<code>async</code>有更多的优点, 但是都是配合 Promise 来使用, 毕竟在现在来说我们的异步都是使用的 Promise 来写的.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> readFile = <span class="function"><span class="keyword">function</span> (<span class="params">fileName</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    fs.readFile(fileName, (err, data) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span>(err) &#123;</span><br><span class="line">        reject(err);</span><br><span class="line">      &#125;</span><br><span class="line">      resolve(data);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generator函数写法</span></span><br><span class="line"><span class="keyword">const</span> gen = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> f1 = <span class="keyword">yield</span> readFile(<span class="string">'f1'</span>);</span><br><span class="line">  <span class="keyword">const</span> f2 = <span class="keyword">yield</span> readFile(<span class="string">'f2'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(f1.toString());</span><br><span class="line">  <span class="built_in">console</span>.log(f2.toString());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generator函数的执行</span></span><br><span class="line">gen.next();</span><br><span class="line">gen.next();</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// async函数写法</span></span><br><span class="line"><span class="keyword">const</span> asy = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> f1 = <span class="keyword">await</span> readFile(<span class="string">'f1'</span>);</span><br><span class="line">  <span class="keyword">const</span> f2 = <span class="keyword">await</span> readFile(<span class="string">'f2'</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(f1.toString());</span><br><span class="line">  <span class="built_in">console</span>.log(f2.toString());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// async函数的执行</span></span><br><span class="line">asy</span><br></pre></td></tr></table></figure>
<p>从上面的比较可以看出, 从形式上来说是关键词不一样.</p>
<ul>
<li><p><code>Generator</code>函数使用<code>*</code>来表示一个异步函数, <code>async</code>函数使用<code>async</code>来表示一个异步函数</p>
</li>
<li><p><code>Generator</code>函数使用<code>yield</code>来进行一个异步操作, <code>async</code>函数使用<code>await</code>来进行一个异步操作(也可以是同步操作)</p>
</li>
</ul>
<p>从内部的工作过程来说, <code>Generator</code>函数没有自动执行的功能, 如果需要内部的异步步骤一步步执行, 那么你需要手动一步步调用<code>gen.next()</code>方法来驱动异步的进行. 而<code>async</code>函数简化了这个过程, 内置了执行器, 可以自动一步一步的按照顺序执行异步操作.</p>
<p>我这里只是一叶障目, generator 有着更多的含义和用法. 在我能够完整的说个大概之前, 还是请参考一些别人的理解吧.</p>
<p>参考文章: <a href="https://juejin.im/post/5b4c22aa6fb9a04faf479be1" target="_blank" rel="noopener">[译] Javascript（ES6）Generator 入门</a></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 一个用于理解 generator 和 next()传参的问题</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i);</span><br><span class="line">  <span class="keyword">const</span> j = <span class="number">5</span> * (<span class="keyword">yield</span> (i * <span class="number">10</span>));</span><br><span class="line">  <span class="built_in">console</span>.log(j);</span><br><span class="line">  <span class="keyword">const</span> k = <span class="keyword">yield</span> (<span class="number">2</span> * k / <span class="number">4</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(k);</span><br><span class="line">  <span class="keyword">return</span> i + j + k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g = gen(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(g.next(<span class="number">20</span>)); <span class="comment">// &#123;value: 100, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(g.next(<span class="number">10</span>)); <span class="comment">// &#123;value: 25, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(g.next(<span class="number">5</span>));  <span class="comment">// &#123;value: 65, done: true&#125;</span></span><br></pre></td></tr></table></figure>

  	</div>
	  
	  <div class="article-tags tags iconfont icon-tags">
      
        <a href="/tags/Generator/">Generator</a>
      
        <a href="/tags/Promise/">Promise</a>
      
        <a href="/tags/async/">async</a>
      
	  </div>
    
		
	
		<div class="art-item-footer">
				
					<span class="art-item-left"><i class="iconfont icon-arrow-circle-left"></i>上一篇: <a href="/optimize-my-blog/" rel="prev" title="个人博客改造过程">
						个人博客改造过程 
					</a></span>
				
				
					<span class="art-item-right">下一篇: <a href="/same-origin-and-CORS/" rel="next" title="same-origin-and-CORS">
						same-origin-and-CORS
					</a><i class="iconfont icon-arrow-circle-right"></i></span>
				
		</div>
	
	</section>
	
</article>
<script>
	window.subData = {
		title: 'Promise-Generator',
		subtitle: '',
		tools: true
	}
</script>

      </div>
      <aside class='l_side'>
        
  <section class="m_widget about">

<img class="avatar" src="" data-src="/images/avatar_blog.png">

<!-- <div class='header'>kricsleo</div> -->
<div class="content">
<div class="desc">难得下雨天</div>
</div>
</section>

  <section class="m_widget categories">
<div class="header">Categories</div>
<div class="content">
    
    <ul class="entry">
    
        <li><a class="flat-box" href="/categories/Front-end/"><div class="name">Front-end</div><div class="badget">10</div></a></li>
    
        <li><a class="flat-box" href="/categories/daily/"><div class="name">daily</div><div class="badget">1</div></a></li>
    
        <li><a class="flat-box" href="/categories/front-end/"><div class="name">front-end</div><div class="badget">13</div></a></li>
    
        <li><a class="flat-box" href="/categories/工具/"><div class="name">工具</div><div class="badget">5</div></a></li>
    
        <li><a class="flat-box" href="/categories/框架/"><div class="name">框架</div><div class="badget">1</div></a></li>
    
        <li><a class="flat-box" href="/categories/通信/"><div class="name">通信</div><div class="badget">2</div></a></li>
    
    </ul>
    
</div>
</section>

  
<div class="m_widget tagcloud">
    <div class="header">Tags</div>
    <div class="content">
        <a href="/tags/AST/" style="font-size: 14px; color: #808080">AST</a> <a href="/tags/CORS/" style="font-size: 14px; color: #808080">CORS</a> <a href="/tags/CSS/" style="font-size: 14px; color: #808080">CSS</a> <a href="/tags/Content-Type/" style="font-size: 14px; color: #808080">Content-Type</a> <a href="/tags/ES6/" style="font-size: 17px; color: #404040">ES6</a> <a href="/tags/Generator/" style="font-size: 14px; color: #808080">Generator</a> <a href="/tags/HTTP/" style="font-size: 14px; color: #808080">HTTP</a> <a href="/tags/HTTP-2-0/" style="font-size: 14px; color: #808080">HTTP/2.0</a> <a href="/tags/JavaScript/" style="font-size: 14px; color: #808080">JavaScript</a> <a href="/tags/MVC/" style="font-size: 14px; color: #808080">MVC</a> <a href="/tags/MVP/" style="font-size: 14px; color: #808080">MVP</a> <a href="/tags/MVVM/" style="font-size: 14px; color: #808080">MVVM</a> <a href="/tags/Mini-Program/" style="font-size: 14px; color: #808080">Mini-Program</a> <a href="/tags/Promise/" style="font-size: 14px; color: #808080">Promise</a> <a href="/tags/SASS/" style="font-size: 14px; color: #808080">SASS</a> <a href="/tags/ast/" style="font-size: 14px; color: #808080">ast</a> <a href="/tags/async/" style="font-size: 14px; color: #808080">async</a> <a href="/tags/bash/" style="font-size: 14px; color: #808080">bash</a> <a href="/tags/codeStyle/" style="font-size: 14px; color: #808080">codeStyle</a> <a href="/tags/cookie/" style="font-size: 14px; color: #808080">cookie</a> <a href="/tags/css/" style="font-size: 20px; color: #000">css</a> <a href="/tags/docker/" style="font-size: 14px; color: #808080">docker</a> <a href="/tags/encrypt/" style="font-size: 17px; color: #404040">encrypt</a> <a href="/tags/flex/" style="font-size: 14px; color: #808080">flex</a> <a href="/tags/function/" style="font-size: 14px; color: #808080">function</a> <a href="/tags/git/" style="font-size: 14px; color: #808080">git</a> <a href="/tags/github/" style="font-size: 14px; color: #808080">github</a> <a href="/tags/h5/" style="font-size: 14px; color: #808080">h5</a> <a href="/tags/http/" style="font-size: 14px; color: #808080">http</a> <a href="/tags/javascript/" style="font-size: 14px; color: #808080">javascript</a> <a href="/tags/markdown/" style="font-size: 14px; color: #808080">markdown</a> <a href="/tags/nginx/" style="font-size: 14px; color: #808080">nginx</a> <a href="/tags/object/" style="font-size: 14px; color: #808080">object</a> <a href="/tags/same-origin/" style="font-size: 14px; color: #808080">same-origin</a> <a href="/tags/service-worker/" style="font-size: 14px; color: #808080">service-worker</a> <a href="/tags/speed/" style="font-size: 14px; color: #808080">speed</a> <a href="/tags/ssh/" style="font-size: 14px; color: #808080">ssh</a> <a href="/tags/todo/" style="font-size: 14px; color: #808080">todo</a> <a href="/tags/vue/" style="font-size: 14px; color: #808080">vue</a> <a href="/tags/web-font/" style="font-size: 14px; color: #808080">web-font</a> <a href="/tags/web优化/" style="font-size: 14px; color: #808080">web优化</a> <a href="/tags/yahoo/" style="font-size: 14px; color: #808080">yahoo</a> <a href="/tags/前端模块化/" style="font-size: 14px; color: #808080">前端模块化</a>
    </div>
</div>



      </aside>
    </div>
  </div>
  <footer class="l_footer clearfix" style="display: none;">
  <div class="copyright">©2018 By 
    <a href="https://github.com/kricsleo">kricsleo</a>
  </div>
  <div class="framework-info">
    Diven - 
    <a href="https://hexo.io/zh-cn/">Hexo</a>
  </div>
</footer>


  

<script>
  function loadCSS() {
    const doc = document;
    const link = doc.createElement('link');
    link.rel = 'stylesheet';
    link.href = '/style.css';
    // link.href = 'https://store.kricsleo.com/blog/static/css/style.css';
    link.onload = () => {
      const dLoader = doc.getElementsByClassName('loader')[0];
      dLoader.style.opacity = 0;
      setTimeout(() => {
        dLoader.parentNode.removeChild(dLoader);
      }, 400);
    }
    doc.head.appendChild(link);
  }
  loadCSS();
</script>
<!-- <script src="https://store.kricsleo.com/blog/static/js/index.js"></script> -->
<script src="/js/index.js"></script>

</body>
</html>

<!DOCTYPE html>
<html lang="zh-cn">

<head>

  
  <meta charset="UTF-8">
  <title>
    POJ1989 Distance Queries | World of Forks
  </title>


  
  <meta name="viewport" content="width=device-width,user-scalable=no,maximum-scale=1,initial-scale=1">

  
  <link rel="canonical" href="https://kricsleo.github.io/docs/posts/poj1989-distance-queries/" />

  
  
  <link href="https://fonts.cat.net/icon?family=Material+Icons" rel="stylesheet">
  <link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/ocean.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://kricsleo.github.io/docs/css/index.css">
  
  <link href="https://kricsleo.github.io/docs/index.xml" rel="alternate" type="application/rss+xml" title="World of Forks" />
  <link href="https://kricsleo.github.io/docs/index.xml" rel="feed" type="application/rss+xml" title="World of Forks" />

  
  <link href="https://kricsleo.github.io/docs/favicon.ico" rel="shortcut icon">

  <script>
    window.baseURL = 'https:\/\/kricsleo.github.io\/docs';
  </script>
</head>







<body>
  <div class="navbar-fixed">
    <nav class="navbar">
      <div class="nav-container container">
        <div class="nav-wrapper inner">
          <a href="javascript:void(0)" data-activates="sidebar" class="button-collapse hide-on-large-only">
            <i class="material-icons">menu</i>
          </a>
          <a href="https://kricsleo.github.io/docs" class="brand-logo">
            <i class="material-icons hide-on-med-and-down">restaurant_menu</i>
            World of Forks
          </a>
          
          <ul class=" nav-menu tabs tabs-transparent hide-on-med-and-down">
            
            <li class="tab">
              <a href="https://kricsleo.github.io/docs/docs/" class=''>
                Home
              </a>
            </li>
            
            <li class="tab">
              <a href="https://kricsleo.github.io/docs/docs/archive/" class=''>
                Archive
              </a>
            </li>
            
            <li class="tab">
              <a href="https://kricsleo.github.io/docs/docs/about/" class=''>
                About
              </a>
            </li>
            
          </ul>
          

          <form class="nav-form hide-on-small-and-down">
            <div class="form-group">
              <i class="material-icons">search</i>
              <input type='text' placeholder="输入搜索关键字" />
            </div>
            <div class="form-popout">
              <div class="search-result">
                <label>暂无搜索结果</label>
                <ul>
                </ul>
              </div>
            </div>
          </form>


          <ul class=" nav-menu apps">
            
            <li>
              <a class="search-btn hide-on-med-and-up" href='#search-panel'>
                <i class="material-icons">search</i>
              </a>
            </li>
            <li>
              <a class="term-btn hide-on-small-and-down" href='#term-panel'>
                <i class="material-icons">apps</i>
              </a>
            </li>
            <li>
              <a class="rss-btn hide-on-small-and-down" href='https://kricsleo.github.io/docs/index.xml' target="_blank">
                <i class="material-icons">rss_feed</i>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </div>

  
  <div class="mobile-search hide-on-med-and-up">
  <div class="header">
    
    <i class="material-icons">search</i>
    <input type='text' placeholder="输入搜索关键字" />
    <i class="material-icons mobile-search-close">cancel</i>
  </div>
  <div class="content">
    <label>暂无搜索结果</label>
    <ul></ul>
  </div>
</div>
  

  <div class="taxonomy">
    <div class="container">
      <div class="inner">
        <div class="taxonomy-panel">
          
          <div class='group'>
            <label>Category</label>
            <ul>
                
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/categories/acm'> acm
                  <span class="badge">24</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/categories/web'> web
                  <span class="badge">14</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/categories/linux'> linux
                  <span class="badge">8</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/categories/asp.net'> asp.net
                  <span class="badge">2</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/categories/cloud-computing'> cloud-computing
                  <span class="badge">2</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/categories/gfw'> gfw
                  <span class="badge">2</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/categories/hexo'> hexo
                  <span class="badge">2</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/categories/openwrt'> openwrt
                  <span class="badge">2</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/categories/ide/editor'> ide/editor
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/categories/python'> python
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/categories/tech-daily'> tech-daily
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/categories/tool'> tool
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/categories/wine'> wine
                  <span class="badge">1</span>
                </a>
              </li>
              
            </ul>
          </div>
          
          <div class='group'>
            <label>Tag</label>
            <ul>
                
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/polymer'> polymer
                  <span class="badge">7</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/%E5%9B%BE%E8%AE%BA'> 图论
                  <span class="badge">7</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/%E6%95%B0%E8%AE%BA'> 数论
                  <span class="badge">6</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/%E6%9A%B4%E5%8A%9B'> 暴力
                  <span class="badge">6</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/graphql'> graphql
                  <span class="badge">5</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/tarjan'> tarjan
                  <span class="badge">5</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/de/wm'> de/wm
                  <span class="badge">4</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/html'> html
                  <span class="badge">4</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/%E5%8F%AA%E8%A8%80%E7%89%87%E8%AF%AD'> 只言片语
                  <span class="badge">4</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/lca'> lca
                  <span class="badge">3</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/algorithm'> algorithm
                  <span class="badge">2</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/asp.net-mvc4'> asp.net-mvc4
                  <span class="badge">2</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/centos'> centos
                  <span class="badge">2</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/golang'> golang
                  <span class="badge">2</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/lcs'> lcs
                  <span class="badge">2</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/shadowsocks'> shadowsocks
                  <span class="badge">2</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/%E6%8B%9B%E8%81%98'> 招聘
                  <span class="badge">2</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/%E7%BD%91%E6%98%93'> 网易
                  <span class="badge">2</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/api'> api
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/blog-generator'> blog-generator
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/chinadns'> chinadns
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/deepin'> deepin
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/docker'> docker
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/dom'> dom
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/dp'> dp
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/encryption'> encryption
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/git'> git
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/gnome'> gnome
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/go'> go
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/gtk'> gtk
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/hugo'> hugo
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/i3wm'> i3wm
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/infinality-fonts'> infinality-fonts
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/instantclick'> instantclick
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/ipv6'> ipv6
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/javascirpt'> javascirpt
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/kubernetes'> kubernetes
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/linux'> linux
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/meow'> meow
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/neutron'> neutron
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/octotree'> octotree
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/openstack'> openstack
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/openwrt'> openwrt
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/ppa'> ppa
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/prezto'> prezto
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/pt'> pt
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/python'> python
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/rmq'> rmq
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/simplemembership'> simplemembership
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/sublime-text'> sublime-text
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/tmux'> tmux
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/xfce4'> xfce4
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/%E5%80%8D%E5%A2%9E'> 倍增
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/%E6%A0%91%E5%BD%A2dp'> 树形dp
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/%E6%A0%91%E7%9A%84%E7%9B%B4%E5%BE%84'> 树的直径
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/%E7%9F%A9%E9%98%B5'> 矩阵
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91'> 科学上网
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/%E7%BB%84%E5%90%88'> 组合
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/%E7%BD%91%E6%98%93%E4%BA%91%E9%9F%B3%E4%B9%90'> 网易云音乐
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/%E7%BD%91%E7%BB%9C%E6%B5%81'> 网络流
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/%E7%BE%8E%E5%8C%96'> 美化
                  <span class="badge">1</span>
                </a>
              </li>
              
              <li>
                <a class="btn btn-secondary" href='https://kricsleo.github.io/docs/tags/%E8%B7%AF%E7%94%B1%E5%99%A8'> 路由器
                  <span class="badge">1</span>
                </a>
              </li>
              
            </ul>
          </div>
           
        </div>
      </div>
    </div>
  </div>

  
  <ul class="side-nav" id="sidebar">
    
    <li>
      <a href="https://kricsleo.github.io/docs/docs/" class=''>
        Home
      </a>
    </li>
    
    <li>
      <a href="https://kricsleo.github.io/docs/docs/archive/" class=''>
        Archive
      </a>
    </li>
    
    <li>
      <a href="https://kricsleo.github.io/docs/docs/about/" class=''>
        About
      </a>
    </li>
    
    <li>
      <a class="term-btn-mobile hide-on-med-only" href='https://kricsleo.github.io/docs/categories/'>
        Categories
      </a>
    </li>
    <li>
      <a class="term-btn-mobile hide-on-med-only" href='https://kricsleo.github.io/docs/tags/'>
        Tags
      </a>
    </li>
    <li>
      <a class="rss-btn-mobile hide-on-med-only" href='https://kricsleo.github.io/docs/index.xml' target="_blank">
        Rss
      </a>
    </li>
  </ul>
  




<main id="single" role="main" class="main-panel">
  <div class="page-content">
    <div class="container container-ex">
      <div class="inner">
        <section class="post-wrapper">
          
          <div class="post reveal  no-toc ">
            <div class="card">
              <section class="breadcrumb-root">
  <div class="breadcrumbs" role="navigation" aria-label="breadcrumbs navigation">
     

    <a class="breadcrumb" href="https://kricsleo.github.io/docs">
      <i class="material-icons">location_on</i>Home</a>
      
    
        
    
      
    
        
    
      
    <span class="breadcrumb">POJ1989 Distance Queries</span>

        
    
      
  </div>
</section>
              
              <div class="card-header postinfo">
                <span class="card-title">POJ1989 Distance Queries </span>
              </div>
              <div class="card-header date">
                
                <div class="group">
                  <i class="material-icons">book</i>
                  <address>
                    归档：
                    <a href="https://kricsleo.github.io/docs/categories/acm">ACM</a>&nbsp; 
                  </address>
                </div>
                
                <div class="group">
                  <i class="material-icons">flag</i>
                  <time>创建：2014年08月 1日
                  </time>
                </div>
                
                <div class="group">
                  <i class="material-icons">mode_edit</i>
                  <time>修改：2018年09月 8日
                  </time>
                </div>
                
                

              </div>
              
              <div class="card-content">

                <article class="article">
                  <p>##Description</p>

<p>Farmer John&rsquo;s cows refused to run in his marathon since he chose a path much too long for their leisurely lifestyle. He therefore wants to find a path of a more reasonable length. The input to this problem consists of the same input as in &ldquo;Navigation Nightmare&rdquo;,followed by a line containing a single integer K, followed by K &ldquo;distance queries&rdquo;. Each distance query is a line of input containing two integers, giving the numbers of two farms between which FJ is interested in computing distance (measured in the length of the roads along the path between the two farms). Please answer FJ&rsquo;s distance queries as quickly as possible!<br />
<br />
##Input</p>

<ul>
<li>Lines 1..1+M: Same format as &ldquo;Navigation Nightmare&rdquo;<br /></li>
<li>Line 2+M: A single integer, K. 1 &lt;= K &lt;= 10,000<br /></li>
<li>Lines 3+M..2+M+K: Each line corresponds to a distance query and contains the indices of two farms.<br />
<br /></li>
</ul>

<p>##Output</p>

<ul>
<li>Lines 1..K: For each distance query, output on a single line an integer giving the appropriate distance.<br />
<br /></li>
</ul>

<p>##Sample Input</p>

<p>7 6<br />
1 6 13 E<br />
6 3 9 E<br />
3 5 7 S<br />
4 1 3 N<br />
2 4 20 W<br />
4 7 2 S<br />
3<br />
1 6<br />
1 4<br />
2 6</p>

<p>##Sample Output<br />
13<br />
3<br />
36</p>

<p>##Hint<br />
Farms 2 and 6 are 20+3+13=36 apart.</p>

<p>##Source<br />
<a href="http://poj.org/searchproblem?field=source&amp;amp;key=USACO+2004+February">USACO 2004 February</a><br />
<br/></p>

<hr />

<ul>
<li>无向树求节点距离：<code>dist(u,v)=dist(root,u)+dist(root,v)-2*dist(root,lca(u,v))</code><br /></li>
<li>tarjan+并查集求LCA。注意可能树不连通。<br />
<br /></li>
</ul>

<pre><code class="language-C++">#include&amp;lt;map&amp;gt;
#include&amp;lt;set&amp;gt;
#include&amp;lt;stack&amp;gt;
#include&amp;lt;queue&amp;gt;
#include&amp;lt;string&amp;gt;
#include&amp;lt;cstdio&amp;gt;
#include&amp;lt;vector&amp;gt;
#include&amp;lt;cctype&amp;gt;
#include&amp;lt;cassert&amp;gt;
#include&amp;lt;utility&amp;gt;
#include&amp;lt;numeric&amp;gt;
#include&amp;lt;cstring&amp;gt;
#include&amp;lt;iostream&amp;gt;
#include&amp;lt;algorithm&amp;gt;
using namespace std;
#define pr pair
#define MP make_pair
#define VI(x) vector&amp;lt;x&amp;gt;::iterator
#define MI(x,y) map&amp;lt;x,y&amp;gt;::iterator
#define SI(x) set&amp;lt;x&amp;gt;::iterator
#define F first
#define S second
#define clrQ(x) while(!x.empty)x.pop();
#define clrA(x,y) memset(x,y,sizeof(x));
#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)
#define LL __int64
#define LLS &quot;%&quot; &quot;I&quot; &quot;6&quot; &quot;4&quot; &quot;d&quot;
#define LLU &quot;%&quot; &quot;I&quot; &quot;6&quot; &quot;4&quot; &quot;u&quot;
#define LL_MAX _I64_MAX
#else
#define LL long long
#define LLS &quot;%&quot; &quot;l&quot; &quot;l&quot; &quot;d&quot;
#define LLU &quot;%&quot; &quot;l&quot; &quot;l&quot; &quot;u&quot;
#define LL_MAX _I64_MAX
#endif
const int inf = ~0u &amp;gt;&amp;gt; 1;
const LL lnf = ~0ull &amp;gt;&amp;gt; 1;
#define N 40005
#define M 40005
int n, m;
//Edge Graph
int head[N], pos;
struct Edge {
    int v, w, nxt;
} e[M &amp;lt;&amp;lt; 1];
void initEdge() {
    memset(head, -1, sizeof(head));
    pos = 0;
}
void add(int u, int v, int w) {
    e[pos].v = v;
    e[pos].w = w;
    e[pos].nxt = head[u];
    head[u] = pos++;
}
//UnionSet
int p[N];
void initUset() {
    for (int i = 0; i &amp;lt;= n; i++)
        p[i] = i;
}
int uFind(int x) {
    return x == p[x] ? p[x] : p[x] = uFind(p[x]);
}
void uMerge(int x, int y) { //y合并到x
    int fx = uFind(x);
    int fy = uFind(y);
    if (fx != fy) p[fy] = fx;
}
//tarjan-LCA
int size,bcnt;
int lca[10005];
int vis[N];
int dis[N];
int ans[10005];
vector&amp;lt;pr&amp;lt;int, int&amp;gt; &amp;gt; query[N];
int findRoot() {
    for (int i = 1; i &amp;lt;= n; i++) {
        if (!vis[i]) return i;
    }
    return assert(false),-1;
}
int dfs(int u, int fa) {
    int solved = 0;
    for (int i = head[u]; ~i; i = e[i].nxt) {
        int v = e[i].v;
        if (v == fa) continue;
        dis[v] = dis[u] + e[i].w;
        solved += dfs(v, u);
        if (solved == size) return solved;
        uMerge(u, v);
    }
    vis[u] = bcnt;
    for (int i = 0; i &amp;lt; (int) query[u].size(); i++) {
        int v = query[u][i].F;
        if (vis[v]==bcnt) {
            solved++;
            lca[query[u][i].S] = uFind(v);
            ans[query[u][i].S] = dis[u] + dis[v] - 2 * dis[lca[query[u][i].S]];
        }
    }
    return solved;
}
void tarjan() {
    clrA(vis, 0);
    clrA(dis, 0);
    int tot = 0;
    bcnt=0;
    do {
        bcnt++;//从1开始
        tot += dfs(findRoot(), -1);
    } while (tot &amp;lt; size);//图可能不连通
}

int main() {
    while (~scanf(&quot;%d%d&quot;, &amp;amp;n, &amp;amp;m)) {
        int u, v, w;
        char c;
        initEdge();
        for (int i = 1; i &amp;lt;= m; i++) {
            scanf(&quot;%d%d%d %c&quot;, &amp;amp;u, &amp;amp;v, &amp;amp;w, &amp;amp;c);
            add(u, v, w);
            add(v, u, w);
        }
        initUset();
        scanf(&quot;%d&quot;, &amp;amp;size);
        for (int i = 1; i &amp;lt;= n; i++)
            query[i].clear();
        for (int i = 1; i &amp;lt;= size; i++) {
            scanf(&quot;%d%d&quot;, &amp;amp;u, &amp;amp;v);
            query[u].push_back(MP(v, i));
            query[v].push_back(MP(u, i));
        }
        tarjan();
        for (int i = 1; i &amp;lt;= size; i++) {
            printf(&quot;%d\n&quot;, ans[i]);
        }
    }
}
</code></pre>

<p>另外，还可以转化为RMQ问题求解：</p>

<pre><code class="language-C++">#include&amp;lt;map&amp;gt;
#include&amp;lt;set&amp;gt;
#include&amp;lt;stack&amp;gt;
#include&amp;lt;queue&amp;gt;
#include&amp;lt;string&amp;gt;
#include&amp;lt;cstdio&amp;gt;
#include&amp;lt;vector&amp;gt;
#include&amp;lt;cctype&amp;gt;
#include&amp;lt;cassert&amp;gt;
#include&amp;lt;utility&amp;gt;
#include&amp;lt;numeric&amp;gt;
#include&amp;lt;cstring&amp;gt;
#include&amp;lt;iostream&amp;gt;
#include&amp;lt;algorithm&amp;gt;
using namespace std;
#define pr pair
#define MP make_pair
#define SI(x) set&amp;lt;x&amp;gt;::iterator
#define VI(x) vector&amp;lt;x&amp;gt;::iterator
#define MI(x,y) map&amp;lt;x,y&amp;gt;::iterator
#define SRI(x) set&amp;lt;x&amp;gt;::reverse_iterator
#define VRI(x) vector&amp;lt;x&amp;gt;::reverse_iterator
#define MRI(x,y) map&amp;lt;x,y&amp;gt;::reverse_iterator
#define F first
#define S second
#define clrQ(x) while(!x.empty)x.pop();
#define clrA(x,y) memset(x,y,sizeof(x));
#if defined (_WIN32) || defined (__WIN32) || defined (WIN32) || defined (__WIN32__)
#define LL __int64
#define LLS &quot;%&quot; &quot;I&quot; &quot;6&quot; &quot;4&quot; &quot;d&quot;
#define LLU &quot;%&quot; &quot;I&quot; &quot;6&quot; &quot;4&quot; &quot;u&quot;
#define LL_MAX _I64_MAX
#else
#define LL long long
#define LLS &quot;%&quot; &quot;l&quot; &quot;l&quot; &quot;d&quot;
#define LLU &quot;%&quot; &quot;l&quot; &quot;l&quot; &quot;u&quot;
#define LL_MAX _I64_MAX
#endif
const int inf = ~0u &amp;gt;&amp;gt; 1;
const LL lnf = ~0ull &amp;gt;&amp;gt; 1;
#define N 40005
#define M 40005
int n, m;
//Edge Graph
int head[N], pos;
struct Edge {
    int v, w, nxt;
} e[M &amp;lt;&amp;lt; 1];
void initEdge() {
    memset(head, -1, sizeof(head));
    pos = 0;
}
void add(int u, int v, int w) {
    e[pos].v = v;
    e[pos].w = w;
    e[pos].nxt = head[u];
    head[u] = pos++;
}
//RMQ
int dpM[20][N&amp;lt;&amp;lt;1|1];//dpM[i][j]  从j开始的，连续2^i个数字的最值,j从1开始
int lg2[N&amp;lt;&amp;lt;1|1];//等价于 (int)lg2(1.0*m)/lg2(2.0) 若空间不足可以这样写
#define getLeft(R,L) (R-(L)+1) //输入右端点和长度，返回左端点
void initRMQ(int n) {
    lg2[0]=-1;int limit;
    for(int i=1;i&amp;lt;=n;i++) {
        lg2[i]=(i&amp;amp;(i-1))?lg2[i-1]:lg2[i-1]+1;
    }
    for(int i=1;i&amp;lt;=lg2[n];i++){
        limit=getLeft(n,1&amp;lt;&amp;lt;i);
        for(int j=1;j&amp;lt;=limit;j++){
            dpM[i][j]=min(dpM[i-1][j],dpM[i-1][j+(1&amp;lt;&amp;lt;i&amp;gt;&amp;gt;1)]);
        }
    }
}
int getRMQ(int a,int b) {
    int t=lg2[b-a+1];
    int s1=a;
    int s2=getLeft(b,1&amp;lt;&amp;lt;t);
    //return max(Max[t][s1],Max[t][s2]);
    return min(dpM[t][s1],dpM[t][s2]);
}
#undef getLeft
//LCA
int dist[N];
int H[N];//节点第一次出现的位置
int E[N&amp;lt;&amp;lt;1|1];//欧拉序列2n+1个
int cnt,depth;
int findRoot(){
    for(int i=1;i&amp;lt;=n;i++)return i;
    return -1;
}
void getEuler(int u=findRoot(),int fa=-1){
    int tmp=dpM[0][H[u]=++cnt]=++depth;
    E[tmp]=u;
    for(int i=head[u];~i;i=e[i].nxt){
        int v=e[i].v;
        if(v==fa)continue;
        dist[v]=dist[u]+e[i].w;
        getEuler(v,u);
        dpM[0][++cnt]=tmp;
    }
}
void initLCA(){
    memset(dist,0,sizeof(dist));
    cnt=depth=0;
    getEuler();
    initRMQ(cnt);
}
int getLCA(int u,int v){
    if(H[u]&amp;gt;H[v])swap(u,v);
    return E[getRMQ(H[u],H[v])];
}
int main() {
    while (~scanf(&quot;%d%d&quot;, &amp;amp;n, &amp;amp;m)) {
        int u, v, w;
        char c;
        initEdge();
        for (int i = 1; i &amp;lt;= m; i++) {
            scanf(&quot;%d%d%d %c&quot;, &amp;amp;u, &amp;amp;v, &amp;amp;w, &amp;amp;c);
            add(u, v, w);
            add(v, u, w);
        }
        initLCA();
        scanf(&quot;%d&quot;,&amp;amp;m);
        while(m--){
            scanf(&quot;%d%d&quot;,&amp;amp;u,&amp;amp;v);
            printf(&quot;%d\n&quot;,dist[u]+dist[v]-2*dist[getLCA(u,v)]);
        }
    }
}
</code></pre>
                </article>

              </div>
              
              <div class="card-action card-action-links">
                
                <a class="btn btn-secondary" href="https://kricsleo.github.io/docs/tags/lca">LCA</a> 
                <a class="btn btn-secondary" href="https://kricsleo.github.io/docs/tags/rmq">RMQ</a> 
                <a class="btn btn-secondary" href="https://kricsleo.github.io/docs/tags/%E5%9B%BE%E8%AE%BA">图论</a> 
                <a class="btn btn-secondary" href="https://kricsleo.github.io/docs/tags/tarjan">tarjan</a> 
              </div>
              
              <div class="card-action">
                  
<div id="comment"></div>
<style>
  .v .vwrap .vheader .vinput:focus {
    border-bottom-color: #607d8b;
  }
</style>
<script>
  window.VALINECONFIG = {
    el: '#comment',
    notify: false,
    verify: false,
    appId: 'drenIDLMO3yTwiuCl7Hva9nq-gzGzoHsz',
    appKey: 'rfotKaw6cevwHhOR8FvhwPAp',
    placeholder: '写点什么吧...',
    path: window.location.pathname,
    avatar: 'retro'
  }
</script>  
              </div>

              
              <div class="pagination-single">
                 
                <span class="pagination-item previous">
                  <i class="material-icons">navigate_before</i>
                  <a href="https://kricsleo.github.io/docs/posts/zjnu2073-geasscode/" rel="prev">内网2073 城主GeassCode</a>
                </span>  
                
                
                <span class="pagination-item next">
                  <a href="https://kricsleo.github.io/docs/posts/poj1330-nearest-common-ancestors/" rel="next">POJ1330 Nearest Common Ancestors</a>
                  <i class="material-icons">navigate_next</i>
                </span> 
              </div>
              

            </div>
          </div>
        </section>
      </div>
    </div>
  </div>
  <footer class="page-footer">
  <div class="container">
    <div class="inner">
      <div class="wrapper">
        <div class="group group-slink">
          <h5>World of Forks</h5>
          <p>Theme
            <a href="https://github.com/stkevintan/canoe" target="_blank">canoe</a> designed by
            <a href="https://github.com/stkevintan" target="_blank">Kevin Tan</a> with ❤</p>
          <ul class='slink'>
             
            <li>
              <a href="https://github.com/stkevintan" target="_blank" title="Github">
                <svg class='svg-icons svg-icons-github'><use xlink:href='#svg-icons-github'></use></svg>
              </a>
            </li>
            
            <li>
              <a href="https://twitter.com/kevinsfork" target="_blank" title="Twitter">
                <svg class='svg-icons svg-icons-twitter'><use xlink:href='#svg-icons-twitter'></use></svg>
              </a>
            </li>
            
            <li>
              <a href="http://weibo.com/kevinclasky" target="_blank" title="Weibo">
                <svg class='svg-icons svg-icons-sina-weibo'><use xlink:href='#svg-icons-sina-weibo'></use></svg>
              </a>
            </li>
             
          </ul>
        </div>
        <div class="group group-flink">
          <h5>My Friends</h5>
          <ul>
            
            <li>
              <a href="https://frantic1048.logdown.com/" target="_blank">Frantic1048</a>
            </li>
            
            <li>
              <a href="https://hclmaster.github.io/" target="_blank">HclMaster</a>
            </li>
            
            <li>
              <a href="https://whst.github.io/" target="_blank">WANG Hsü-Tung</a>
            </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="footer-copyright">
    <div class="container">
      <div class="inner">Copyleft@Kevin Tan</div>
    </div>
  </div>
</footer>
</main>

<script type="text/javascript" async src="//cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type="text/javascript" src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/languages/go.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/languages/typescript.min.js"></script>
<script>
  hljs.configure({
    tabReplace: '  '
  })
  hljs.registerLanguage("graphql", function (e) { return { aliases: ["gql"], k: { keyword: "query mutation subscription|10 type interface union scalar fragment|10 enum on ...", literal: "true false null" }, c: [e.HCM, e.QSM, e.NM, { cN: "type", b: "[^\\w][A-Z][a-z]", e: "\\W", eE: !0 }, { cN: "literal", b: "[^\\w][A-Z][A-Z]", e: "\\W", eE: !0 }, { cN: "variable", b: "\\$", e: "\\W", eE: !0 }, { cN: "keyword", b: "[.]{2}", e: "\\." }, { cN: "meta", b: "@", e: "\\W", eE: !0 }], i: /([;<']|BEGIN)/ } });
  hljs.initHighlightingOnLoad();
  
</script>


<script type="text/javascript" src="https://kricsleo.github.io/docs/js/polyfill.js"></script>
<script type="text/javascript" src="https://kricsleo.github.io/docs/js/index.js"></script>


<script src="/service-worker.js"></script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/service-worker.js').then(function(reg) {
      reg.onupdatefound = function() {
        var installingWorker = reg.installing;
        installingWorker.onstatechange = function() {
          switch (installingWorker.state) {
            case 'installed':
              if (navigator.serviceWorker.controller) {
                console.log('New or updated content is available.');
              } else {
                console.log('Content is now available offline!');
              }
              break;
            case 'redundant':
              console.error('The installing service worker became redundant.');
              break;
          }
        };
      };
    }).catch(function(e) {
      console.error('Error during service worker registration:', e);
    });
  });
}
</script>
</body>

</html>
